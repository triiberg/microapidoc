package microapidoc

import (
	"os"

	"github.com/gin-gonic/gin"
)

func (c *Microapidoc) DocIndexHAndler(ctx *gin.Context) {

	filePath := "./index.html"
	indexHtml, err := os.ReadFile(filePath)
	if err != nil {
		ctx.String(500, "Failed to read index HTML file: %v", err)
		return
	}
	ctx.Data(200, "text/html; charset=utf-8", []byte(indexHtml))
	return

	/*
		indexB64 := `PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KPGhlYWQ+CiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEuMCI+CiAgICA8dGl0bGU+QVBJIERvY3VtZW50YXRpb248L3RpdGxlPgogICAgPHN0eWxlPgogICAgICAgIGJvZHkgewogICAgICAgICAgICBmb250LWZhbWlseTogLWFwcGxlLXN5c3RlbSwgQmxpbmtNYWNTeXN0ZW1Gb250LCAnU2Vnb2UgVUknLCBSb2JvdG8sIE94eWdlbiwgVWJ1bnR1LCBDYW50YXJlbGwsICdPcGVuIFNhbnMnLCAnSGVsdmV0aWNhIE5ldWUnLCBzYW5zLXNlcmlmOwogICAgICAgICAgICBsaW5lLWhlaWdodDogMS42OwogICAgICAgICAgICBjb2xvcjogIzMzMzsKICAgICAgICAgICAgbWF4LXdpZHRoOiAxMjAwcHg7CiAgICAgICAgICAgIG1hcmdpbjogMCBhdXRvOwogICAgICAgICAgICBwYWRkaW5nOiAyMHB4OwogICAgICAgIH0KICAgICAgICBoZWFkZXIgewogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiBibHVlOwogICAgICAgICAgICBjb2xvcjogd2hpdGU7CiAgICAgICAgICAgIHBhZGRpbmc6IDIwcHg7CiAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDIwcHg7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDRweDsKICAgICAgICB9CiAgICAgICAgLmF1dGgtc2VjdGlvbiB7CiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICNmOGY4Zjg7CiAgICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkICNkZGQ7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDRweDsKICAgICAgICAgICAgcGFkZGluZzogMTVweDsKICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogMjBweDsKICAgICAgICB9CiAgICAgICAgLmF1dGgtdGl0bGUgewogICAgICAgICAgICBmb250LXdlaWdodDogYm9sZDsKICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogMTBweDsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOwogICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgIH0KICAgICAgICAuYXV0aC10YWJsZSB7CiAgICAgICAgICAgIHdpZHRoOiAxMDAlOwogICAgICAgICAgICBib3JkZXItY29sbGFwc2U6IGNvbGxhcHNlOwogICAgICAgIH0KICAgICAgICAuYXV0aC10YWJsZSB0aCwgLmF1dGgtdGFibGUgdGQgewogICAgICAgICAgICB0ZXh0LWFsaWduOiBsZWZ0OwogICAgICAgICAgICBwYWRkaW5nOiA4cHg7CiAgICAgICAgICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjZWVlOwogICAgICAgIH0KICAgICAgICAuYXV0aC10YWJsZSB0aCB7CiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICNmNWY1ZjU7CiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiBub3JtYWw7CiAgICAgICAgICAgIGNvbG9yOiAjNjY2OwogICAgICAgIH0KICAgICAgICAuYXV0aC10YWJsZSBpbnB1dCB7CiAgICAgICAgICAgIHdpZHRoOiAxMDAlOwogICAgICAgICAgICBwYWRkaW5nOiA2cHg7CiAgICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkICNkZGQ7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDNweDsKICAgICAgICAgICAgZm9udC1mYW1pbHk6IG1vbm9zcGFjZTsKICAgICAgICB9CiAgICAgICAgLmF1dGgtc2F2ZWQtaW5kaWNhdG9yIHsKICAgICAgICAgICAgZGlzcGxheTogbm9uZTsKICAgICAgICAgICAgY29sb3I6ICM0Q0FGNTA7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMC44ZW07CiAgICAgICAgICAgIG1hcmdpbi1sZWZ0OiAxMHB4OwogICAgICAgICAgICBhbmltYXRpb246IGZhZGVPdXQgMnMgZm9yd2FyZHM7CiAgICAgICAgfQogICAgICAgIC5hdXRoLWRlZmF1bHQgewogICAgICAgICAgICBmb250LXNpemU6IDAuOGVtOwogICAgICAgICAgICBjb2xvcjogIzY2NjsKICAgICAgICB9CiAgICAgICAgQGtleWZyYW1lcyBmYWRlT3V0IHsKICAgICAgICAgICAgMCUgeyBvcGFjaXR5OiAxOyB9CiAgICAgICAgICAgIDcwJSB7IG9wYWNpdHk6IDE7IH0KICAgICAgICAgICAgMTAwJSB7IG9wYWNpdHk6IDA7IH0KICAgICAgICB9CiAgICAgICAgLmdyb3VwIHsKICAgICAgICAgICAgYm9yZGVyOiAxcHggc29saWQgI2RkZDsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNHB4OwogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAyMHB4OwogICAgICAgICAgICBvdmVyZmxvdzogaGlkZGVuOwogICAgICAgIH0KICAgICAgICAuZ3JvdXAtaGVhZGVyIHsKICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogI2Y1ZjVmNTsKICAgICAgICAgICAgcGFkZGluZzogMTBweCAxNXB4OwogICAgICAgICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOwogICAgICAgICAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgI2RkZDsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOwogICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgIH0KICAgICAgICAuZ3JvdXAtY29udGVudCB7CiAgICAgICAgICAgIHBhZGRpbmc6IDA7CiAgICAgICAgfQogICAgICAgIC5lbmRwb2ludCB7CiAgICAgICAgICAgIGJvcmRlcjogMnB4IHNvbGlkICNhYWE7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDRweDsKICAgICAgICAgICAgcGFkZGluZzogMTVweDsKICAgICAgICAgICAgcG9zaXRpb246IHJlbGF0aXZlOwogICAgICAgICAgICBtYXJnaW46IDE1cHg7CiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICNmZmY7CiAgICAgICAgfQogICAgICAgIC5lbmRwb2ludDpsYXN0LWNoaWxkIHsKICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogMTVweDsKICAgICAgICB9CiAgICAgICAgLmVuZHBvaW50LWhlYWRlciB7CiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgICAgIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsKICAgICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogMTBweDsKICAgICAgICB9CiAgICAgICAgLmVuZHBvaW50LW5hbWUgewogICAgICAgICAgICBmb250LXdlaWdodDogYm9sZDsKICAgICAgICAgICAgZm9udC1zaXplOiAxLjFlbTsKICAgICAgICB9CiAgICAgICAgLmVuZHBvaW50LWRlc2NyaXB0aW9uIHsKICAgICAgICAgICAgY29sb3I6ICM2NjY7CiAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDEwcHg7CiAgICAgICAgfQogICAgICAgIC5tZXRob2QgewogICAgICAgICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CiAgICAgICAgICAgIHBhZGRpbmc6IDRweCA4cHg7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDNweDsKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7CiAgICAgICAgICAgIGNvbG9yOiB3aGl0ZTsKICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogIzk5OTsKICAgICAgICAgICAgbWFyZ2luLXJpZ2h0OiAxMHB4OwogICAgICAgIH0KICAgICAgICAubWV0aG9kLmdldCB7CiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICM2MWFmZmU7CiAgICAgICAgfQogICAgICAgIC5tZXRob2QucG9zdCB7CiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICM0OWNjOTA7CiAgICAgICAgfQogICAgICAgIC5tZXRob2QucHV0IHsKICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogI2ZjYTEzMDsKICAgICAgICB9CiAgICAgICAgLm1ldGhvZC5kZWxldGUgewogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZjkzZTNlOwogICAgICAgIH0KICAgICAgICAubWV0aG9kLnVua25vd24gewogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjOTk5OwogICAgICAgIH0KICAgICAgICAudXJsIHsKICAgICAgICAgICAgZm9udC1mYW1pbHk6IG1vbm9zcGFjZTsKICAgICAgICAgICAgcGFkZGluZzogNHB4IDhweDsKICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogI2Y1ZjVmNTsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogM3B4OwogICAgICAgIH0KICAgICAgICAucGFyYW1ldGVycyB7CiAgICAgICAgICAgIG1hcmdpbi10b3A6IDE1cHg7CiAgICAgICAgfQogICAgICAgIC5wYXJhbWV0ZXItZ3JvdXAgewogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAxNXB4OwogICAgICAgIH0KICAgICAgICAucGFyYW1ldGVyLWdyb3VwLXRpdGxlIHsKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7CiAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDVweDsKICAgICAgICAgICAgY29sb3I6ICM1NTU7CiAgICAgICAgfQogICAgICAgIC5wYXJhbWV0ZXItdGFibGUgewogICAgICAgICAgICB3aWR0aDogMTAwJTsKICAgICAgICAgICAgYm9yZGVyLWNvbGxhcHNlOiBjb2xsYXBzZTsKICAgICAgICB9CiAgICAgICAgLnBhcmFtZXRlci10YWJsZSB0aCwgLnBhcmFtZXRlci10YWJsZSB0ZCB7CiAgICAgICAgICAgIHRleHQtYWxpZ246IGxlZnQ7CiAgICAgICAgICAgIHBhZGRpbmc6IDhweDsKICAgICAgICAgICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNlZWU7CiAgICAgICAgfQogICAgICAgIC5wYXJhbWV0ZXItdGFibGUgdGggewogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZjVmNWY1OwogICAgICAgICAgICBmb250LXdlaWdodDogbm9ybWFsOwogICAgICAgICAgICBjb2xvcjogIzY2NjsKICAgICAgICB9CiAgICAgICAgLnBhcmFtZXRlci10YWJsZSBpbnB1dCB7CiAgICAgICAgICAgIHdpZHRoOiAxMDAlOwogICAgICAgICAgICBwYWRkaW5nOiA2cHg7CiAgICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkICNkZGQ7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDNweDsKICAgICAgICAgICAgZm9udC1mYW1pbHk6IG1vbm9zcGFjZTsKICAgICAgICB9CiAgICAgICAgLmxhYmVscyB7CiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgICAgIGdhcDogNXB4OwogICAgICAgICAgICBtYXJnaW4tdG9wOiA1cHg7CiAgICAgICAgfQogICAgICAgIC5sYWJlbCB7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMC44ZW07CiAgICAgICAgICAgIHBhZGRpbmc6IDJweCA2cHg7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDEwcHg7CiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICNlZWU7CiAgICAgICAgfQogICAgICAgIC5sYWJlbC5kZXByZWNhdGVkIHsKICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogI2Y5M2UzZTsKICAgICAgICAgICAgY29sb3I6IHdoaXRlOwogICAgICAgIH0KICAgICAgICAubGFiZWwucHJvZHVjdGlvbiB7CiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICM0OWNjOTA7CiAgICAgICAgICAgIGNvbG9yOiB3aGl0ZTsKICAgICAgICB9CiAgICAgICAgLmxhYmVsLmRldmVsb3BtZW50IHsKICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogI2ZjYTEzMDsKICAgICAgICAgICAgY29sb3I6IHdoaXRlOwogICAgICAgIH0KICAgICAgICAudG9nZ2xlLWJ0biB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IG5vbmU7CiAgICAgICAgICAgIGJvcmRlcjogbm9uZTsKICAgICAgICAgICAgZm9udC1zaXplOiAxLjJlbTsKICAgICAgICAgICAgY29sb3I6ICM2NjY7CiAgICAgICAgICAgIHBvaW50ZXItZXZlbnRzOiBub25lOyAvKiBNYWtlIHRoZSBidXR0b24gbm90IGNhcHR1cmUgY2xpY2tzICovCiAgICAgICAgfQogICAgICAgIC5oaWRkZW4gewogICAgICAgICAgICBkaXNwbGF5OiBub25lOwogICAgICAgIH0KICAgICAgICAudHJ5LWl0LWJ0biB7CiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICM0Q0FGNTA7CiAgICAgICAgICAgIGNvbG9yOiB3aGl0ZTsKICAgICAgICAgICAgYm9yZGVyOiBub25lOwogICAgICAgICAgICBwYWRkaW5nOiA4cHggMTZweDsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNHB4OwogICAgICAgICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOwogICAgICAgICAgICBtYXJnaW4tdG9wOiAxNXB4OwogICAgICAgICAgICB3aWR0aDogMTAwJTsKICAgICAgICB9CiAgICAgICAgLnRyeS1pdC1idG46aG92ZXIgewogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjNDVhMDQ5OwogICAgICAgIH0KICAgICAgICAudHJ5LWl0LXNlY3Rpb24gewogICAgICAgICAgICBtYXJnaW4tdG9wOiAyMHB4OwogICAgICAgICAgICBib3JkZXItdG9wOiAxcHggc29saWQgI2VlZTsKICAgICAgICAgICAgcGFkZGluZy10b3A6IDIwcHg7CiAgICAgICAgfQogICAgICAgIC5yZXNwb25zZS1zZWN0aW9uIHsKICAgICAgICAgICAgbWFyZ2luLXRvcDogMjBweDsKICAgICAgICAgICAgYm9yZGVyOiAxcHggc29saWQgI2RkZDsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNHB4OwogICAgICAgICAgICBvdmVyZmxvdzogaGlkZGVuOwogICAgICAgIH0KICAgICAgICAucmVzcG9uc2UtaGVhZGVyIHsKICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogI2Y1ZjVmNTsKICAgICAgICAgICAgcGFkZGluZzogMTBweCAxNXB4OwogICAgICAgICAgICBmb250LXdlaWdodDogYm9sZDsKICAgICAgICAgICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNkZGQ7CiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgICAgIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsKICAgICAgICB9CiAgICAgICAgLnJlc3BvbnNlLXN0YXR1cyB7CiAgICAgICAgICAgIHBhZGRpbmc6IDRweCA4cHg7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDNweDsKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7CiAgICAgICAgICAgIGNvbG9yOiB3aGl0ZTsKICAgICAgICB9CiAgICAgICAgLnJlc3BvbnNlLXN0YXR1cy5zdWNjZXNzIHsKICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogIzQ5Y2M5MDsKICAgICAgICB9CiAgICAgICAgLnJlc3BvbnNlLXN0YXR1cy5lcnJvciB7CiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICNmOTNlM2U7CiAgICAgICAgfQogICAgICAgIC5yZXNwb25zZS1jb250ZW50IHsKICAgICAgICAgICAgcGFkZGluZzogMTVweDsKICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogI2Y4ZjhmODsKICAgICAgICB9CiAgICAgICAgLnJlc3BvbnNlLWhlYWRlcnMtdGl0bGUsIC5yZXNwb25zZS1ib2R5LXRpdGxlIHsKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7CiAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDhweDsKICAgICAgICAgICAgY29sb3I6ICM1NTU7CiAgICAgICAgfQogICAgICAgIC5yZXNwb25zZS1oZWFkZXJzIHsKICAgICAgICAgICAgZm9udC1mYW1pbHk6IG1vbm9zcGFjZTsKICAgICAgICAgICAgd2hpdGUtc3BhY2U6IHByZS13cmFwOwogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAxNXB4OwogICAgICAgICAgICBwYWRkaW5nOiAxMHB4OwogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZjBmMGYwOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiAzcHg7CiAgICAgICAgICAgIGJvcmRlci1sZWZ0OiAzcHggc29saWQgI2RkZDsKICAgICAgICB9CiAgICAgICAgLnJlc3BvbnNlLWJvZHkgewogICAgICAgICAgICBmb250LWZhbWlseTogbW9ub3NwYWNlOwogICAgICAgICAgICB3aGl0ZS1zcGFjZTogcHJlLXdyYXA7CiAgICAgICAgICAgIHBhZGRpbmc6IDEwcHg7CiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICNmMGYwZjA7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDNweDsKICAgICAgICAgICAgYm9yZGVyLWxlZnQ6IDNweCBzb2xpZCAjZGRkOwogICAgICAgIH0KICAgICAgICAucmVzcG9uc2UtZGl2aWRlciB7CiAgICAgICAgICAgIGhlaWdodDogMXB4OwogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZWVlOwogICAgICAgICAgICBtYXJnaW46IDE1cHggMDsKICAgICAgICB9CiAgICAgICAgLnRleHRhcmVhLXdyYXBwZXIgewogICAgICAgICAgICBtYXJnaW4tdG9wOiAxMHB4OwogICAgICAgIH0KICAgICAgICAudGV4dGFyZWEtd3JhcHBlciB0ZXh0YXJlYSB7CiAgICAgICAgICAgIHdpZHRoOiAxMDAlOwogICAgICAgICAgICBtaW4taGVpZ2h0OiAxMDBweDsKICAgICAgICAgICAgcGFkZGluZzogOHB4OwogICAgICAgICAgICBib3JkZXI6IDFweCBzb2xpZCAjZGRkOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiAzcHg7CiAgICAgICAgICAgIGZvbnQtZmFtaWx5OiBtb25vc3BhY2U7CiAgICAgICAgICAgIHJlc2l6ZTogdmVydGljYWw7CiAgICAgICAgfQogICAgICAgIC5sb2FkaW5nIHsKICAgICAgICAgICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgICAgICAgICBwYWRkaW5nOiA0MHB4OwogICAgICAgICAgICBmb250LXNpemU6IDEuMmVtOwogICAgICAgICAgICBjb2xvcjogIzY2NjsKICAgICAgICB9CiAgICAgICAgLmVycm9yLW1lc3NhZ2UgewogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZjhkN2RhOwogICAgICAgICAgICBjb2xvcjogIzcyMWMyNDsKICAgICAgICAgICAgcGFkZGluZzogMTVweDsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNHB4OwogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAyMHB4OwogICAgICAgICAgICBib3JkZXI6IDFweCBzb2xpZCAjZjVjNmNiOwogICAgICAgIH0KICAgICAgICAvKiBDdXN0b20gaGVhZGVyIGhpZ2hsaWdodGluZyAqLwogICAgICAgIC5oZWFkZXItaGlnaGxpZ2h0IHsKICAgICAgICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrOwogICAgICAgICAgICBwYWRkaW5nOiAycHggNHB4OwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiAzcHg7CiAgICAgICAgICAgIGNvbG9yOiB3aGl0ZTsKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7CiAgICAgICAgfQogICAgICAgIC5oZWFkZXItaGlnaGxpZ2h0LmdyZWVuIHsKICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogIzQ5Y2M5MDsKICAgICAgICB9CiAgICAgICAgLmhlYWRlci1oaWdobGlnaHQucmVkIHsKICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogI2Y5M2UzZTsKICAgICAgICB9CiAgICAgICAgLmhlYWRlci1oaWdobGlnaHQuYmx1ZSB7CiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICM2MWFmZmU7CiAgICAgICAgfQogICAgICAgIC5oZWFkZXItaGlnaGxpZ2h0Lm9yYW5nZSB7CiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICNmY2ExMzA7CiAgICAgICAgfQogICAgICAgIC5oZWFkZXItaGlnaGxpZ2h0LnB1cnBsZSB7CiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICM5MDEyZmU7CiAgICAgICAgfQogICAgICAgIC5oZWFkZXItaGlnaGxpZ2h0LmJsYWNrIHsKICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogIzMzMzsKICAgICAgICB9CiAgICA8L3N0eWxlPgo8L2hlYWQ+Cjxib2R5PgogICAgPGhlYWRlcj4KICAgICAgICA8aDEgaWQ9ImFwaS10aXRsZSI+PC9oMT4KICAgICAgICA8cCBpZD0iYnVpbGQiPkJ1aWxkOiA8c3BhbiBpZD0iYnVpbGQtbnVtYmVyIj48L3NwYW4+LCBzdGFydGVkIEAgPHNwYW4gaWQ9InN0YXJ0ZWQtdGltZSI+PC9zcGFuPjwvcD4KICAgIDwvaGVhZGVyPgogICAgCiAgICA8IS0tIEdsb2JhbCBBdXRoIEhlYWRlcnMgU2VjdGlvbiAtLT4KICAgIDxkaXYgY2xhc3M9ImF1dGgtc2VjdGlvbiI+CiAgICAgICAgPGRpdiBjbGFzcz0iYXV0aC10aXRsZSI+CiAgICAgICAgICAgIDxzcGFuPkF1dGhlbnRpY2F0aW9uIEhlYWRlcnM8L3NwYW4+CiAgICAgICAgICAgIDxzcGFuIGlkPSJhdXRoLXNhdmVkLWluZGljYXRvciIgY2xhc3M9ImF1dGgtc2F2ZWQtaW5kaWNhdG9yIj5TYXZlZDwvc3Bhbj4KICAgICAgICAgICAgPHNwYW4gaWQ9ImF1dGgtZGVmYXVsdCIgY2xhc3M9ImF1dGgtZGVmYXVsdCI+PC9zcGFuPgogICAgICAgIDwvZGl2PgogICAgICAgIDx0YWJsZSBjbGFzcz0iYXV0aC10YWJsZSIgaWQ9Imdsb2JhbC1hdXRoLXRhYmxlIj4KICAgICAgIAogICAgICAgICAgICA8dGJvZHk+CiAgICAgICAgICAgICAgICA8IS0tIEF1dGggaGVhZGVycyB3aWxsIGJlIGFkZGVkIGhlcmUgZHluYW1pY2FsbHkgLS0+CiAgICAgICAgICAgIDwvdGJvZHk+CiAgICAgICAgPC90YWJsZT4KCiAgICA8L2Rpdj4KICAgIAogICAgPGRpdiBpZD0iYXBpLWRvY3MiPgogICAgICAgIDxkaXYgY2xhc3M9ImxvYWRpbmciPkxvYWRpbmcgQVBJIGRvY3VtZW50YXRpb24uLi48L2Rpdj4KICAgIDwvZGl2PgoKICAgIDxzY3JpcHQ+CiAgICAgICAgLy8gQ29va2llIGhlbHBlciBmdW5jdGlvbnMKICAgICAgICBmdW5jdGlvbiBzZXRDb29raWUobmFtZSwgdmFsdWUsIGRheXMpIHsKICAgICAgICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKCk7CiAgICAgICAgICAgIGRhdGUuc2V0VGltZShkYXRlLmdldFRpbWUoKSArIChkYXlzICogMjQgKiA2MCAqIDYwICogMTAwMCkpOwogICAgICAgICAgICBjb25zdCBleHBpcmVzID0gImV4cGlyZXM9IiArIGRhdGUudG9VVENTdHJpbmcoKTsKICAgICAgICAgICAgZG9jdW1lbnQuY29va2llID0gbmFtZSArICI9IiArIGVuY29kZVVSSUNvbXBvbmVudCh2YWx1ZSkgKyAiOyIgKyBleHBpcmVzICsgIjtwYXRoPS8iOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZ2V0Q29va2llKG5hbWUpIHsKICAgICAgICAgICAgY29uc3QgbmFtZUVRID0gbmFtZSArICI9IjsKICAgICAgICAgICAgY29uc3QgY2EgPSBkb2N1bWVudC5jb29raWUuc3BsaXQoJzsnKTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjYS5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgbGV0IGMgPSBjYVtpXTsKICAgICAgICAgICAgICAgIHdoaWxlIChjLmNoYXJBdCgwKSA9PT0gJyAnKSBjID0gYy5zdWJzdHJpbmcoMSwgYy5sZW5ndGgpOwogICAgICAgICAgICAgICAgaWYgKGMuaW5kZXhPZihuYW1lRVEpID09PSAwKSByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KGMuc3Vic3RyaW5nKG5hbWVFUS5sZW5ndGgsIGMubGVuZ3RoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoKICAgICAgICAvLyBTYXZlIGFjY29yZGlvbiBzdGF0ZSB0byBjb29raWUKICAgICAgICBmdW5jdGlvbiBzYXZlQWNjb3JkaW9uU3RhdGUoZ3JvdXBJZCwgaXNPcGVuKSB7CiAgICAgICAgICAgIHNldENvb2tpZShgYWNjb3JkaW9uXyR7Z3JvdXBJZH1gLCBpc09wZW4gPyAnMScgOiAnMCcsIDMwKTsgLy8gU2F2ZSBmb3IgMzAgZGF5cwogICAgICAgIH0KCiAgICAgICAgLy8gU2hvdyBzYXZlZCBpbmRpY2F0b3IgYnJpZWZseQogICAgICAgIGZ1bmN0aW9uIHNob3dTYXZlZEluZGljYXRvcigpIHsKICAgICAgICAgICAgY29uc3QgaW5kaWNhdG9yID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2F1dGgtc2F2ZWQtaW5kaWNhdG9yJyk7CiAgICAgICAgICAgIGluZGljYXRvci5zdHlsZS5kaXNwbGF5ID0gJ2lubGluZSc7CiAgICAgICAgICAgIGluZGljYXRvci5zdHlsZS5hbmltYXRpb24gPSAnbm9uZSc7CiAgICAgICAgICAgIC8vIFRyaWdnZXIgcmVmbG93CiAgICAgICAgICAgIHZvaWQgaW5kaWNhdG9yLm9mZnNldFdpZHRoOwogICAgICAgICAgICBpbmRpY2F0b3Iuc3R5bGUuYW5pbWF0aW9uID0gJ2ZhZGVPdXQgMnMgZm9yd2FyZHMnOwogICAgICAgIH0KCiAgICAgICAgLy8gU2F2ZSBhIHNwZWNpZmljIGF1dGggdmFsdWUgdG8gY29va2llCiAgICAgICAgZnVuY3Rpb24gc2F2ZUF1dGhUb0Nvb2tpZShuYW1lLCB2YWx1ZSkgewogICAgICAgICAgICBpZiAodmFsdWUpIHsKICAgICAgICAgICAgICAgIHNldENvb2tpZShgYXV0aF8ke25hbWV9YCwgdmFsdWUsIDMwKTsgLy8gU2F2ZSBmb3IgMzAgZGF5cwogICAgICAgICAgICAgICAgc2hvd1NhdmVkSW5kaWNhdG9yKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIEZ1bmN0aW9uIHRvIGhpZ2hsaWdodCByZXNwb25zZSBoZWFkZXJzIGJhc2VkIG9uIGNvbmZpZ3VyYXRpb24KICAgICAgICBmdW5jdGlvbiBoaWdobGlnaHRSZXNwb25zZUhlYWRlcnMoaGVhZGVyVGV4dCwgcmVzcG9uc2VIZWFkZXJzKSB7CiAgICAgICAgICAgIGlmICghcmVzcG9uc2VIZWFkZXJzIHx8ICFyZXNwb25zZUhlYWRlcnMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gaGVhZGVyVGV4dDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbGV0IGhpZ2hsaWdodGVkVGV4dCA9IGhlYWRlclRleHQ7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBDcmVhdGUgYSBtYXAgZm9yIGZhc3RlciBsb29rdXAKICAgICAgICAgICAgY29uc3QgaGVhZGVyTWFwID0ge307CiAgICAgICAgICAgIHJlc3BvbnNlSGVhZGVycy5mb3JFYWNoKGhlYWRlciA9PiB7CiAgICAgICAgICAgICAgICBpZiAoIWhlYWRlck1hcFtoZWFkZXIubmFtZV0pIHsKICAgICAgICAgICAgICAgICAgICBoZWFkZXJNYXBbaGVhZGVyLm5hbWVdID0gW107CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBoZWFkZXJNYXBbaGVhZGVyLm5hbWVdLnB1c2goewogICAgICAgICAgICAgICAgICAgIHZhbHVlOiBoZWFkZXIudmFsdWUsCiAgICAgICAgICAgICAgICAgICAgY29sb3I6IGhlYWRlci5jb2xvciB8fCAnYmx1ZScKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIFByb2Nlc3MgZWFjaCBsaW5lIG9mIHRoZSBoZWFkZXIgdGV4dAogICAgICAgICAgICBjb25zdCBsaW5lcyA9IGhpZ2hsaWdodGVkVGV4dC5zcGxpdCgnXG4nKTsKICAgICAgICAgICAgY29uc3QgcHJvY2Vzc2VkTGluZXMgPSBsaW5lcy5tYXAobGluZSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBjb2xvbkluZGV4ID0gbGluZS5pbmRleE9mKCc6Jyk7CiAgICAgICAgICAgICAgICBpZiAoY29sb25JbmRleCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBoZWFkZXJOYW1lID0gbGluZS5zdWJzdHJpbmcoMCwgY29sb25JbmRleCkudHJpbSgpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGhlYWRlclZhbHVlID0gbGluZS5zdWJzdHJpbmcoY29sb25JbmRleCArIDEpLnRyaW0oKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiAoaGVhZGVyTWFwW2hlYWRlck5hbWVdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoaXMgaGVhZGVyIHZhbHVlIHNob3VsZCBiZSBoaWdobGlnaHRlZAogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtYXRjaGluZ1J1bGUgPSBoZWFkZXJNYXBbaGVhZGVyTmFtZV0uZmluZChydWxlID0+IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcnVsZS52YWx1ZSA9PT0gaGVhZGVyVmFsdWUgfHwgcnVsZS52YWx1ZSA9PT0gJyonKTsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXRjaGluZ1J1bGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBgJHtoZWFkZXJOYW1lfTogPHNwYW4gY2xhc3M9ImhlYWRlci1oaWdobGlnaHQgJHttYXRjaGluZ1J1bGUuY29sb3J9Ij4ke2hlYWRlclZhbHVlfTwvc3Bhbj5gOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGxpbmU7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgcmV0dXJuIHByb2Nlc3NlZExpbmVzLmpvaW4oJ1xuJyk7CiAgICAgICAgfQoKICAgICAgICAvLyBGdW5jdGlvbiB0byBpbml0aWFsaXplIHRoZSBBUEkgZG9jdW1lbnRhdGlvbgogICAgICAgIGZ1bmN0aW9uIGluaXRpYWxpemVBcGlEb2NzKGFwaURvYykgewogICAgICAgICAgICAvLyBDbGVhciBsb2FkaW5nIG1lc3NhZ2UKICAgICAgICAgICAgY29uc3QgYXBpRG9jc0NvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhcGktZG9jcycpOwogICAgICAgICAgICBhcGlEb2NzQ29udGFpbmVyLmlubmVySFRNTCA9ICcnOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gU2V0IHRoZSBkb2N1bWVudCB0aXRsZQogICAgICAgICAgICBkb2N1bWVudC50aXRsZSA9IGFwaURvYy50aXRsZSB8fCAnQVBJIERvY3VtZW50YXRpb24nOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYXBpLXRpdGxlJykudGV4dENvbnRlbnQgPSBhcGlEb2MudGl0bGUgfHwgJ0FQSSBEb2N1bWVudGF0aW9uJzsKCiAgICAgICAgICAgIC8vIFNldCBidWlsZAogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnVpbGQtbnVtYmVyJykudGV4dENvbnRlbnQgPSBhcGlEb2MuYnVpbGQgfHwgJ3YwLjAuMCc7CgogICAgICAgICAgICAvLyBTZXQgc2VydmljZSBzdGFydGVkIHRpbWUKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0YXJ0ZWQtdGltZScpLnRleHRDb250ZW50ID0gYXBpRG9jLnN0YXJ0ZWQgfHwgJ3l5eXktbW0tZGQgaGg6bW06c3MnOwoKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2F1dGgtZGVmYXVsdCcpLnRleHRDb250ZW50ID0gJ0F1dGggZGVmYXVsdDogb24nIHx8ICdBdXRoIGRlZmF1bHQ6IG9mZic7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBTZXQgaGVhZGVyIGNvbG9yIGlmIHNwZWNpZmllZAogICAgICAgICAgICBpZiAoYXBpRG9jLmhlYWRlckNvbG9yKSB7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdoZWFkZXInKS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBhcGlEb2MuaGVhZGVyQ29sb3I7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIENvbGxlY3QgYWxsIHVuaXF1ZSBhdXRoIGhlYWRlcnMgZnJvbSBhbGwgZW5kcG9pbnRzCiAgICAgICAgICAgIGNvbnN0IHVuaXF1ZUF1dGhIZWFkZXJzID0gW107CiAgICAgICAgICAgIGNvbnN0IGF1dGhIZWFkZXJNYXAgPSBuZXcgTWFwKCk7CgogICAgICAgICAgICBhcGlEb2MuZ3JvdXBzLmZvckVhY2goZ3JvdXAgPT4gewogICAgICAgICAgICAgICAgZ3JvdXAuZW5kcG9pbnRzLmZvckVhY2goZW5kcG9pbnQgPT4gewogICAgICAgICAgICAgICAgICAgIGlmIChlbmRwb2ludC5hdXRoSGVhZGVyT24gJiYgZW5kcG9pbnQuYXV0aEhlYWRlcnMgJiYgZW5kcG9pbnQuYXV0aEhlYWRlcnMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBlbmRwb2ludC5hdXRoSGVhZGVycy5mb3JFYWNoKGhlYWRlciA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBrZXkgPSBoZWFkZXIubmFtZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghYXV0aEhlYWRlck1hcC5oYXMoa2V5KSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF1dGhIZWFkZXJNYXAuc2V0KGtleSwgaGVhZGVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bmlxdWVBdXRoSGVhZGVycy5wdXNoKGhlYWRlcik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIFBvcHVsYXRlIGdsb2JhbCBhdXRoIGhlYWRlcnMgdGFibGUKICAgICAgICAgICAgY29uc3QgZ2xvYmFsQXV0aFRhYmxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dsb2JhbC1hdXRoLXRhYmxlJykuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3Rib2R5JylbMF07CiAgICAgICAgICAgIGdsb2JhbEF1dGhUYWJsZS5pbm5lckhUTUwgPSAnJzsgLy8gQ2xlYXIgZXhpc3Rpbmcgcm93cwogICAgICAgICAgICAKICAgICAgICAgICAgdW5pcXVlQXV0aEhlYWRlcnMuZm9yRWFjaChoZWFkZXIgPT4gewogICAgICAgICAgICAgICAgY29uc3Qgcm93ID0gZ2xvYmFsQXV0aFRhYmxlLmluc2VydFJvdygpOwogICAgICAgICAgICAgICAgcm93LmlubmVySFRNTCA9IGAKICAgICAgICAgICAgICAgICAgICA8dGQ+JHtoZWFkZXIubmFtZX08L3RkPgogICAgICAgICAgICAgICAgICAgIDx0ZD48aW5wdXQgdHlwZT0idGV4dCIgaWQ9Imdsb2JhbC1hdXRoLSR7aGVhZGVyLm5hbWV9IiBwbGFjZWhvbGRlcj0iRW50ZXIgJHtoZWFkZXIubmFtZX0iPjwvdGQ+CiAgICAgICAgICAgICAgICBgOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIEFkZCBibHVyIGV2ZW50IGxpc3RlbmVycyB0byBhdXRoIGlucHV0IGZpZWxkcwogICAgICAgICAgICB1bmlxdWVBdXRoSGVhZGVycy5mb3JFYWNoKGhlYWRlciA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBpbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBnbG9iYWwtYXV0aC0ke2hlYWRlci5uYW1lfWApOwogICAgICAgICAgICAgICAgaWYgKGlucHV0KSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignYmx1cicsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBzYXZlQXV0aFRvQ29va2llKGhlYWRlci5uYW1lLCB0aGlzLnZhbHVlKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyBHZW5lcmF0ZSB0aGUgQVBJIGRvY3VtZW50YXRpb24gSFRNTAogICAgICAgICAgICBhcGlEb2MuZ3JvdXBzLmZvckVhY2goKGdyb3VwLCBncm91cEluZGV4KSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBncm91cEVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICAgICAgICAgIGdyb3VwRWxlbWVudC5jbGFzc05hbWUgPSAnZ3JvdXAnOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zdCBncm91cEhlYWRlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgICAgICAgICAgZ3JvdXBIZWFkZXIuY2xhc3NOYW1lID0gJ2dyb3VwLWhlYWRlcic7CiAgICAgICAgICAgICAgICBncm91cEhlYWRlci5pbm5lckhUTUwgPSBgCiAgICAgICAgICAgICAgICAgICAgPHNwYW4+JHtncm91cC5uYW1lfTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJ0b2dnbGUtYnRuIiBkYXRhLXRhcmdldD0iZ3JvdXAtJHtncm91cEluZGV4fSI+KzwvYnV0dG9uPgogICAgICAgICAgICAgICAgYDsKICAgICAgICAgICAgICAgIGdyb3VwRWxlbWVudC5hcHBlbmRDaGlsZChncm91cEhlYWRlcik7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnN0IGdyb3VwQ29udGVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgICAgICAgICAgZ3JvdXBDb250ZW50LmNsYXNzTmFtZSA9ICdncm91cC1jb250ZW50IGhpZGRlbic7IC8vIFN0YXJ0IHdpdGggaGlkZGVuIGNsYXNzCiAgICAgICAgICAgICAgICBncm91cENvbnRlbnQuaWQgPSBgZ3JvdXAtJHtncm91cEluZGV4fWA7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGdyb3VwLmVuZHBvaW50cy5mb3JFYWNoKChlbmRwb2ludCwgZW5kcG9pbnRJbmRleCkgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGVuZHBvaW50RWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgICAgICAgICAgICAgIGVuZHBvaW50RWxlbWVudC5jbGFzc05hbWUgPSAnZW5kcG9pbnQnOwogICAgICAgICAgICAgICAgICAgIGVuZHBvaW50RWxlbWVudC5pZCA9IGBlbmRwb2ludC0ke2dyb3VwSW5kZXh9LSR7ZW5kcG9pbnRJbmRleH1gOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIE1ldGhvZCBjbGFzcyBmb3Igc3R5bGluZwogICAgICAgICAgICAgICAgICAgIGNvbnN0IG1ldGhvZENsYXNzID0gZW5kcG9pbnQubWV0aG9kID8gZW5kcG9pbnQubWV0aG9kLnRvTG93ZXJDYXNlKCkgOiAndW5rbm93bic7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaXNFeGVjdXRhYmxlID0gZW5kcG9pbnQubWV0aG9kICYmIGVuZHBvaW50Lm1ldGhvZCAhPT0gJ1VOS05PV04nOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIENyZWF0ZSBlbmRwb2ludCBoZWFkZXIKICAgICAgICAgICAgICAgICAgICBjb25zdCBlbmRwb2ludEhlYWRlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgICAgICAgICAgICAgIGVuZHBvaW50SGVhZGVyLmNsYXNzTmFtZSA9ICdlbmRwb2ludC1oZWFkZXInOwogICAgICAgICAgICAgICAgICAgIGVuZHBvaW50SGVhZGVyLmlubmVySFRNTCA9IGAKICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJtZXRob2QgJHttZXRob2RDbGFzc30iPiR7ZW5kcG9pbnQubWV0aG9kIHx8ICdVTktOT1dOJ308L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iZW5kcG9pbnQtbmFtZSI+JHtlbmRwb2ludC5uYW1lfTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgYDsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBBZGQgbGFiZWxzIGlmIHRoZXkgZXhpc3QKICAgICAgICAgICAgICAgICAgICBpZiAoZW5kcG9pbnQubGFiZWwgJiYgZW5kcG9pbnQubGFiZWwubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBsYWJlbHNEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWxzRGl2LmNsYXNzTmFtZSA9ICdsYWJlbHMnOwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgZW5kcG9pbnQubGFiZWwuZm9yRWFjaChsYWJlbCA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBsYWJlbFNwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbFNwYW4uY2xhc3NOYW1lID0gYGxhYmVsICR7bGFiZWwudG9Mb3dlckNhc2UoKX1gOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWxTcGFuLnRleHRDb250ZW50ID0gbGFiZWw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbHNEaXYuYXBwZW5kQ2hpbGQobGFiZWxTcGFuKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBlbmRwb2ludEhlYWRlci5hcHBlbmRDaGlsZChsYWJlbHNEaXYpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBlbmRwb2ludEVsZW1lbnQuYXBwZW5kQ2hpbGQoZW5kcG9pbnRIZWFkZXIpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIEFkZCBkZXNjcmlwdGlvbgogICAgICAgICAgICAgICAgICAgIGlmIChlbmRwb2ludC5kZXNjcmlwdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkZXNjcmlwdGlvbkRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbkRpdi5jbGFzc05hbWUgPSAnZW5kcG9pbnQtZGVzY3JpcHRpb24nOwogICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbkRpdi50ZXh0Q29udGVudCA9IGVuZHBvaW50LmRlc2NyaXB0aW9uOwogICAgICAgICAgICAgICAgICAgICAgICBlbmRwb2ludEVsZW1lbnQuYXBwZW5kQ2hpbGQoZGVzY3JpcHRpb25EaXYpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBBZGQgVVJMCiAgICAgICAgICAgICAgICAgICAgY29uc3QgdXJsRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgICAgICAgICAgdXJsRGl2LmlubmVySFRNTCA9IGA8c3BhbiBjbGFzcz0idXJsIj4ke2VuZHBvaW50LnVybH08L3NwYW4+YDsKICAgICAgICAgICAgICAgICAgICBlbmRwb2ludEVsZW1lbnQuYXBwZW5kQ2hpbGQodXJsRGl2KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBQYXJhbWV0ZXJzIHNlY3Rpb24KICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXJhbWV0ZXJzRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgICAgICAgICAgcGFyYW1ldGVyc0Rpdi5jbGFzc05hbWUgPSAncGFyYW1ldGVycyc7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gSGVhZGVyIFBhcmFtZXRlcnMgKGV4Y2x1ZGluZyBhdXRoIGhlYWRlcnMgd2hpY2ggYXJlIG5vdyBnbG9iYWwpCiAgICAgICAgICAgICAgICAgICAgaWYgKGVuZHBvaW50LmhlYWRlclBhcmFtZXRlcnMgJiYgZW5kcG9pbnQuaGVhZGVyUGFyYW1ldGVycy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtZXRlcnNEaXYuYXBwZW5kQ2hpbGQoY3JlYXRlUGFyYW1ldGVyVGFibGUoJ0hlYWRlciBQYXJhbWV0ZXJzJywgZW5kcG9pbnQuaGVhZGVyUGFyYW1ldGVycywgaXNFeGVjdXRhYmxlKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIFF1ZXJ5IFBhcmFtZXRlcnMKICAgICAgICAgICAgICAgICAgICBpZiAoZW5kcG9pbnQucXVlcnlQYXJhbWV0ZXJzICYmIGVuZHBvaW50LnF1ZXJ5UGFyYW1ldGVycy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtZXRlcnNEaXYuYXBwZW5kQ2hpbGQoY3JlYXRlUGFyYW1ldGVyVGFibGUoJ1F1ZXJ5IFBhcmFtZXRlcnMnLCBlbmRwb2ludC5xdWVyeVBhcmFtZXRlcnMsIGlzRXhlY3V0YWJsZSkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBQYXRoIFBhcmFtZXRlcnMKICAgICAgICAgICAgICAgICAgICBpZiAoZW5kcG9pbnQucGF0aFBhcmFtZXRlcnMgJiYgZW5kcG9pbnQucGF0aFBhcmFtZXRlcnMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBwYXJhbWV0ZXJzRGl2LmFwcGVuZENoaWxkKGNyZWF0ZVBhcmFtZXRlclRhYmxlKCdQYXRoIFBhcmFtZXRlcnMnLCBlbmRwb2ludC5wYXRoUGFyYW1ldGVycywgaXNFeGVjdXRhYmxlKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIEJvZHkgUGFyYW1ldGVycwogICAgICAgICAgICAgICAgICAgIGlmIChlbmRwb2ludC5ib2R5UGFyYW1ldGVycyAmJiBlbmRwb2ludC5ib2R5UGFyYW1ldGVycy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGJvZHlQYXJhbUdyb3VwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJvZHlQYXJhbUdyb3VwLmNsYXNzTmFtZSA9ICdwYXJhbWV0ZXItZ3JvdXAnOwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYm9keVBhcmFtVGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICAgICAgICAgICAgICAgICAgYm9keVBhcmFtVGl0bGUuY2xhc3NOYW1lID0gJ3BhcmFtZXRlci1ncm91cC10aXRsZSc7CiAgICAgICAgICAgICAgICAgICAgICAgIGJvZHlQYXJhbVRpdGxlLnRleHRDb250ZW50ID0gJ0JvZHkgUGFyYW1ldGVycyc7CiAgICAgICAgICAgICAgICAgICAgICAgIGJvZHlQYXJhbUdyb3VwLmFwcGVuZENoaWxkKGJvZHlQYXJhbVRpdGxlKTsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc0V4ZWN1dGFibGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRleHRhcmVhV3JhcHBlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dGFyZWFXcmFwcGVyLmNsYXNzTmFtZSA9ICd0ZXh0YXJlYS13cmFwcGVyJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ3JlYXRlIGEgZGVmYXVsdCBKU09OIHN0cnVjdHVyZSBiYXNlZCBvbiB0aGUgYm9keSBwYXJhbWV0ZXJzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgZGVmYXVsdEpzb24gPSB7fTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZHBvaW50LmJvZHlQYXJhbWV0ZXJzLmZvckVhY2gocGFyYW0gPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEhhbmRsZSBhcnJheSB0eXBlcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJhbS50eXBlLnN0YXJ0c1dpdGgoJ1tdJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdEpzb25bcGFyYW0ubmFtZV0gPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0SnNvbltwYXJhbS5uYW1lXSA9ICcnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0YXJlYVdyYXBwZXIuaW5uZXJIVE1MID0gYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZXh0YXJlYSBpZD0iYm9keS1wYXJhbS0ke2dyb3VwSW5kZXh9LSR7ZW5kcG9pbnRJbmRleH0iIHBsYWNlaG9sZGVyPSJFbnRlciByZXF1ZXN0IGJvZHkiPiR7SlNPTi5zdHJpbmdpZnkoZGVmYXVsdEpzb24sIG51bGwsIDIpfTwvdGV4dGFyZWE+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBgOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9keVBhcmFtR3JvdXAuYXBwZW5kQ2hpbGQodGV4dGFyZWFXcmFwcGVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRhYmxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGFibGUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlLmNsYXNzTmFtZSA9ICdwYXJhbWV0ZXItdGFibGUnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUYWJsZSBoZWFkZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRoZWFkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGhlYWQnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZWFkLmlubmVySFRNTCA9IGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dHI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0aD5OYW1lPC90aD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRoPlR5cGU8L3RoPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdHI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBgOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGUuYXBwZW5kQ2hpbGQodGhlYWQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUYWJsZSBib2R5CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0Ym9keSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3Rib2R5Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmRwb2ludC5ib2R5UGFyYW1ldGVycy5mb3JFYWNoKHBhcmFtID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0ciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHIuaW5uZXJIVE1MID0gYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQ+JHtwYXJhbS5uYW1lfTwvdGQ+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZD4ke3BhcmFtLnR5cGV9PC90ZD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRib2R5LmFwcGVuZENoaWxkKHRyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGUuYXBwZW5kQ2hpbGQodGJvZHkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBib2R5UGFyYW1Hcm91cC5hcHBlbmRDaGlsZCh0YWJsZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtZXRlcnNEaXYuYXBwZW5kQ2hpbGQoYm9keVBhcmFtR3JvdXApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBlbmRwb2ludEVsZW1lbnQuYXBwZW5kQ2hpbGQocGFyYW1ldGVyc0Rpdik7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gQWRkICJFeGVjdXRlIiBidXR0b24gZm9yIGV4ZWN1dGFibGUgZW5kcG9pbnRzCiAgICAgICAgICAgICAgICAgICAgaWYgKGlzRXhlY3V0YWJsZSkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0cnlJdEJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpOwogICAgICAgICAgICAgICAgICAgICAgICB0cnlJdEJ1dHRvbi5jbGFzc05hbWUgPSAndHJ5LWl0LWJ0bic7CiAgICAgICAgICAgICAgICAgICAgICAgIHRyeUl0QnV0dG9uLnRleHRDb250ZW50ID0gJ0V4ZWN1dGUnOwogICAgICAgICAgICAgICAgICAgICAgICB0cnlJdEJ1dHRvbi5zZXRBdHRyaWJ1dGUoJ2RhdGEtZW5kcG9pbnQnLCBgJHtncm91cEluZGV4fS0ke2VuZHBvaW50SW5kZXh9YCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRyeUl0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZXhlY3V0ZVJlcXVlc3QpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmRwb2ludEVsZW1lbnQuYXBwZW5kQ2hpbGQodHJ5SXRCdXR0b24pOwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWRkIHJlc3BvbnNlIHNlY3Rpb24gKGluaXRpYWxseSBoaWRkZW4pCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlU2VjdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZVNlY3Rpb24uY2xhc3NOYW1lID0gJ3Jlc3BvbnNlLXNlY3Rpb24gaGlkZGVuJzsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2VTZWN0aW9uLmlkID0gYHJlc3BvbnNlLSR7Z3JvdXBJbmRleH0tJHtlbmRwb2ludEluZGV4fWA7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZVNlY3Rpb24uaW5uZXJIVE1MID0gYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icmVzcG9uc2UtaGVhZGVyIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj5SZXNwb25zZTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0icmVzcG9uc2Utc3RhdHVzIiBpZD0ic3RhdHVzLSR7Z3JvdXBJbmRleH0tJHtlbmRwb2ludEluZGV4fSI+PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJyZXNwb25zZS1jb250ZW50Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJyZXNwb25zZS1oZWFkZXJzLXRpdGxlIj5IZWFkZXJzOjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InJlc3BvbnNlLWhlYWRlcnMiIGlkPSJyZXNwb25zZS1oZWFkZXJzLSR7Z3JvdXBJbmRleH0tJHtlbmRwb2ludEluZGV4fSI+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icmVzcG9uc2UtYm9keS10aXRsZSI+Qm9keTo8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJyZXNwb25zZS1ib2R5IiBpZD0icmVzcG9uc2UtYm9keS0ke2dyb3VwSW5kZXh9LSR7ZW5kcG9pbnRJbmRleH0iPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIGA7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBlbmRwb2ludEVsZW1lbnQuYXBwZW5kQ2hpbGQocmVzcG9uc2VTZWN0aW9uKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgZ3JvdXBDb250ZW50LmFwcGVuZENoaWxkKGVuZHBvaW50RWxlbWVudCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZ3JvdXBFbGVtZW50LmFwcGVuZENoaWxkKGdyb3VwQ29udGVudCk7CiAgICAgICAgICAgICAgICBhcGlEb2NzQ29udGFpbmVyLmFwcGVuZENoaWxkKGdyb3VwRWxlbWVudCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQWRkIHRvZ2dsZSBmdW5jdGlvbmFsaXR5IHRvIHRoZSBlbnRpcmUgZ3JvdXAgaGVhZGVyCiAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5ncm91cC1oZWFkZXInKS5mb3JFYWNoKGhlYWRlciA9PiB7CiAgICAgICAgICAgICAgICBoZWFkZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXRJZCA9IHRoaXMucXVlcnlTZWxlY3RvcignLnRvZ2dsZS1idG4nKS5nZXRBdHRyaWJ1dGUoJ2RhdGEtdGFyZ2V0Jyk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0RWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRhcmdldElkKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCB0b2dnbGVCdXR0b24gPSB0aGlzLnF1ZXJ5U2VsZWN0b3IoJy50b2dnbGUtYnRuJyk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgKHRhcmdldEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdoaWRkZW4nKSkgewogICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgICAgICAgICB0b2dnbGVCdXR0b24udGV4dENvbnRlbnQgPSAnLSc7CiAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVBY2NvcmRpb25TdGF0ZSh0YXJnZXRJZCwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0RWxlbWVudC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgICAgICAgICAgdG9nZ2xlQnV0dG9uLnRleHRDb250ZW50ID0gJysnOwogICAgICAgICAgICAgICAgICAgICAgICBzYXZlQWNjb3JkaW9uU3RhdGUodGFyZ2V0SWQsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBMb2FkIGFjY29yZGlvbiBzdGF0ZXMgZnJvbSBjb29raWVzCiAgICAgICAgICAgIGxvYWRBY2NvcmRpb25TdGF0ZXMoKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIExvYWQgYXV0aCB2YWx1ZXMgZnJvbSBjb29raWVzCiAgICAgICAgICAgIGxvYWRBdXRoRnJvbUNvb2tpZXModW5pcXVlQXV0aEhlYWRlcnMpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBGdW5jdGlvbiB0byBjcmVhdGUgcGFyYW1ldGVyIHRhYmxlcwogICAgICAgIGZ1bmN0aW9uIGNyZWF0ZVBhcmFtZXRlclRhYmxlKHRpdGxlLCBwYXJhbWV0ZXJzLCBpc0V4ZWN1dGFibGUpIHsKICAgICAgICAgICAgY29uc3QgcGFyYW1ldGVyR3JvdXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICAgICAgcGFyYW1ldGVyR3JvdXAuY2xhc3NOYW1lID0gJ3BhcmFtZXRlci1ncm91cCc7CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCBwYXJhbWV0ZXJUaXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgICAgICBwYXJhbWV0ZXJUaXRsZS5jbGFzc05hbWUgPSAncGFyYW1ldGVyLWdyb3VwLXRpdGxlJzsKICAgICAgICAgICAgcGFyYW1ldGVyVGl0bGUudGV4dENvbnRlbnQgPSB0aXRsZTsKICAgICAgICAgICAgcGFyYW1ldGVyR3JvdXAuYXBwZW5kQ2hpbGQocGFyYW1ldGVyVGl0bGUpOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgdGFibGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0YWJsZScpOwogICAgICAgICAgICB0YWJsZS5jbGFzc05hbWUgPSAncGFyYW1ldGVyLXRhYmxlJzsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFRhYmxlIGhlYWRlcgogICAgICAgICAgICBjb25zdCB0aGVhZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RoZWFkJyk7CiAgICAgICAgICAgIHRoZWFkLmlubmVySFRNTCA9IGAKICAgICAgICAgICAgICAgIDx0cj4KICAgICAgICAgICAgICAgICAgICA8dGg+TmFtZTwvdGg+CiAgICAgICAgICAgICAgICAgICAgPHRoPlR5cGU8L3RoPgogICAgICAgICAgICAgICAgICAgICR7aXNFeGVjdXRhYmxlID8gJzx0aD5WYWx1ZTwvdGg+JyA6ICcnfQogICAgICAgICAgICAgICAgPC90cj4KICAgICAgICAgICAgYDsKICAgICAgICAgICAgdGFibGUuYXBwZW5kQ2hpbGQodGhlYWQpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gVGFibGUgYm9keQogICAgICAgICAgICBjb25zdCB0Ym9keSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3Rib2R5Jyk7CiAgICAgICAgICAgIHBhcmFtZXRlcnMuZm9yRWFjaCgocGFyYW0sIGluZGV4KSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCB0ciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7CiAgICAgICAgICAgICAgICB0ci5pbm5lckhUTUwgPSBgCiAgICAgICAgICAgICAgICAgICAgPHRkPiR7cGFyYW0ubmFtZX08L3RkPgogICAgICAgICAgICAgICAgICAgIDx0ZD4ke3BhcmFtLnR5cGV9PC90ZD4KICAgICAgICAgICAgICAgICAgICAke2lzRXhlY3V0YWJsZSA/IGA8dGQ+PGlucHV0IHR5cGU9InRleHQiIGlkPSIke3RpdGxlLnRvTG93ZXJDYXNlKCkucmVwbGFjZSgnICcsICctJyl9LSR7cGFyYW0ubmFtZX0iIHBsYWNlaG9sZGVyPSJFbnRlciAke3BhcmFtLm5hbWV9Ij48L3RkPmAgOiAnJ30KICAgICAgICAgICAgICAgIGA7CiAgICAgICAgICAgICAgICB0Ym9keS5hcHBlbmRDaGlsZCh0cik7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0YWJsZS5hcHBlbmRDaGlsZCh0Ym9keSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBwYXJhbWV0ZXJHcm91cC5hcHBlbmRDaGlsZCh0YWJsZSk7CiAgICAgICAgICAgIHJldHVybiBwYXJhbWV0ZXJHcm91cDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gTG9hZCBhY2NvcmRpb24gc3RhdGVzIGZyb20gY29va2llcwogICAgICAgIGZ1bmN0aW9uIGxvYWRBY2NvcmRpb25TdGF0ZXMoKSB7CiAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5ncm91cC1jb250ZW50JykuZm9yRWFjaChjb250ZW50ID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGdyb3VwSWQgPSBjb250ZW50LmlkOwogICAgICAgICAgICAgICAgY29uc3QgaXNPcGVuID0gZ2V0Q29va2llKGBhY2NvcmRpb25fJHtncm91cElkfWApID09PSAnMSc7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIChpc09wZW4pIHsKICAgICAgICAgICAgICAgICAgICBjb250ZW50LmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYGJ1dHRvbltkYXRhLXRhcmdldD0iJHtncm91cElkfSJdYCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGJ1dHRvbikgewogICAgICAgICAgICAgICAgICAgICAgICBidXR0b24udGV4dENvbnRlbnQgPSAnLSc7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gTG9hZCBhdXRoIHZhbHVlcyBmcm9tIGNvb2tpZXMKICAgICAgICBmdW5jdGlvbiBsb2FkQXV0aEZyb21Db29raWVzKHVuaXF1ZUF1dGhIZWFkZXJzKSB7CiAgICAgICAgICAgIHVuaXF1ZUF1dGhIZWFkZXJzLmZvckVhY2goaGVhZGVyID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGNvb2tpZVZhbHVlID0gZ2V0Q29va2llKGBhdXRoXyR7aGVhZGVyLm5hbWV9YCk7CiAgICAgICAgICAgICAgICBpZiAoY29va2llVmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBpbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBnbG9iYWwtYXV0aC0ke2hlYWRlci5uYW1lfWApOwogICAgICAgICAgICAgICAgICAgIGlmIChpbnB1dCkgewogICAgICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZSA9IGNvb2tpZVZhbHVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIEZ1bmN0aW9uIHRvIGV4ZWN1dGUgcmVxdWVzdAogICAgICAgIGZ1bmN0aW9uIGV4ZWN1dGVSZXF1ZXN0KGUpIHsKICAgICAgICAgICAgY29uc3QgZW5kcG9pbnRJZCA9IGUudGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS1lbmRwb2ludCcpOwogICAgICAgICAgICBjb25zdCBbZ3JvdXBJbmRleCwgZW5kcG9pbnRJbmRleF0gPSBlbmRwb2ludElkLnNwbGl0KCctJykubWFwKE51bWJlcik7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBHZXQgdGhlIGN1cnJlbnQgYXBpRG9jIGZyb20gdGhlIHdpbmRvdyBvYmplY3QKICAgICAgICAgICAgY29uc3QgYXBpRG9jID0gd2luZG93LmFwaURvY0RhdGE7CiAgICAgICAgICAgIGNvbnN0IGVuZHBvaW50ID0gYXBpRG9jLmdyb3Vwc1tncm91cEluZGV4XS5lbmRwb2ludHNbZW5kcG9pbnRJbmRleF07CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBTaG93IHJlc3BvbnNlIHNlY3Rpb24KICAgICAgICAgICAgY29uc3QgcmVzcG9uc2VTZWN0aW9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHJlc3BvbnNlLSR7Z3JvdXBJbmRleH0tJHtlbmRwb2ludEluZGV4fWApOwogICAgICAgICAgICByZXNwb25zZVNlY3Rpb24uY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBCdWlsZCByZXF1ZXN0IFVSTAogICAgICAgICAgICBsZXQgdXJsID0gZW5kcG9pbnQudXJsOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQWRkIHBhdGggcGFyYW1ldGVycwogICAgICAgICAgICBpZiAoZW5kcG9pbnQucGF0aFBhcmFtZXRlcnMgJiYgZW5kcG9pbnQucGF0aFBhcmFtZXRlcnMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgZW5kcG9pbnQucGF0aFBhcmFtZXRlcnMuZm9yRWFjaChwYXJhbSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgcGF0aC1wYXJhbWV0ZXJzLSR7cGFyYW0ubmFtZX1gKS52YWx1ZTsKICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVwbGFjZSBwbGFjZWhvbGRlciBpbiBVUkwgd2l0aCBhY3R1YWwgdmFsdWUKICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBpcyBhIHNpbXBsaWZpY2F0aW9uIC0gaW4gYSByZWFsIGFwcCwgeW91J2QgbmVlZCB0byBoYW5kbGUgdGhlIGFjdHVhbCBVUkwgcGF0dGVybgogICAgICAgICAgICAgICAgICAgICAgICB1cmwgPSB1cmwucmVwbGFjZShgeyR7cGFyYW0ubmFtZX19YCwgdmFsdWUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBBZGQgcXVlcnkgcGFyYW1ldGVycwogICAgICAgICAgICBpZiAoZW5kcG9pbnQucXVlcnlQYXJhbWV0ZXJzICYmIGVuZHBvaW50LnF1ZXJ5UGFyYW1ldGVycy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBjb25zdCBxdWVyeVBhcmFtcyA9IFtdOwogICAgICAgICAgICAgICAgZW5kcG9pbnQucXVlcnlQYXJhbWV0ZXJzLmZvckVhY2gocGFyYW0gPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHF1ZXJ5LXBhcmFtZXRlcnMtJHtwYXJhbS5uYW1lfWApLnZhbHVlOwogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICBxdWVyeVBhcmFtcy5wdXNoKGAke3BhcmFtLm5hbWV9PSR7ZW5jb2RlVVJJQ29tcG9uZW50KHZhbHVlKX1gKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKHF1ZXJ5UGFyYW1zLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICB1cmwgKz0gKHVybC5pbmNsdWRlcygnPycpID8gJyYnIDogJz8nKSArIHF1ZXJ5UGFyYW1zLmpvaW4oJyYnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQnVpbGQgcmVxdWVzdCBoZWFkZXJzCiAgICAgICAgICAgIGNvbnN0IGhlYWRlcnMgPSB7fTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEdldCBhbGwgdW5pcXVlIGF1dGggaGVhZGVycwogICAgICAgICAgICBjb25zdCB1bmlxdWVBdXRoSGVhZGVycyA9IFtdOwogICAgICAgICAgICBjb25zdCBhdXRoSGVhZGVyTWFwID0gbmV3IE1hcCgpOwogICAgICAgICAgICAKICAgICAgICAgICAgYXBpRG9jLmdyb3Vwcy5mb3JFYWNoKGdyb3VwID0+IHsKICAgICAgICAgICAgICAgIGdyb3VwLmVuZHBvaW50cy5mb3JFYWNoKGVuZHBvaW50ID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAoZW5kcG9pbnQuYXV0aEhlYWRlck9uICYmIGVuZHBvaW50LmF1dGhIZWFkZXJzICYmIGVuZHBvaW50LmF1dGhIZWFkZXJzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgZW5kcG9pbnQuYXV0aEhlYWRlcnMuZm9yRWFjaChoZWFkZXIgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qga2V5ID0gaGVhZGVyLm5hbWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWF1dGhIZWFkZXJNYXAuaGFzKGtleSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdXRoSGVhZGVyTWFwLnNldChrZXksIGhlYWRlcik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5pcXVlQXV0aEhlYWRlcnMucHVzaChoZWFkZXIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBBZGQgZ2xvYmFsIGF1dGggaGVhZGVycyB0byBhbGwgcmVxdWVzdHMKICAgICAgICAgICAgdW5pcXVlQXV0aEhlYWRlcnMuZm9yRWFjaChoZWFkZXIgPT4gewogICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgZ2xvYmFsLWF1dGgtJHtoZWFkZXIubmFtZX1gKS52YWx1ZTsKICAgICAgICAgICAgICAgIGlmICh2YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGhlYWRlcnNbaGVhZGVyLm5hbWVdID0gdmFsdWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQWRkIGhlYWRlciBwYXJhbWV0ZXJzCiAgICAgICAgICAgIGlmIChlbmRwb2ludC5oZWFkZXJQYXJhbWV0ZXJzICYmIGVuZHBvaW50LmhlYWRlclBhcmFtZXRlcnMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgZW5kcG9pbnQuaGVhZGVyUGFyYW1ldGVycy5mb3JFYWNoKHBhcmFtID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBoZWFkZXItcGFyYW1ldGVycy0ke3BhcmFtLm5hbWV9YCkudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnNbcGFyYW0ubmFtZV0gPSB2YWx1ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQnVpbGQgcmVxdWVzdCBib2R5CiAgICAgICAgICAgIGxldCBib2R5ID0gbnVsbDsKICAgICAgICAgICAgaWYgKGVuZHBvaW50LmJvZHlQYXJhbWV0ZXJzICYmIGVuZHBvaW50LmJvZHlQYXJhbWV0ZXJzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIGNvbnN0IGJvZHlUZXh0YXJlYSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBib2R5LXBhcmFtLSR7Z3JvdXBJbmRleH0tJHtlbmRwb2ludEluZGV4fWApOwogICAgICAgICAgICAgICAgaWYgKGJvZHlUZXh0YXJlYSAmJiBib2R5VGV4dGFyZWEudmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICBib2R5ID0gSlNPTi5wYXJzZShib2R5VGV4dGFyZWEudmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzWydDb250ZW50LVR5cGUnXSA9ICdhcHBsaWNhdGlvbi9qc29uJzsKICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNob3cgZXJyb3IgaWYgSlNPTiBpcyBpbnZhbGlkCiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGByZXNwb25zZS1ib2R5LSR7Z3JvdXBJbmRleH0tJHtlbmRwb2ludEluZGV4fWApLnRleHRDb250ZW50ID0gJ0Vycm9yOiBJbnZhbGlkIEpTT04gaW4gcmVxdWVzdCBib2R5JzsKICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHN0YXR1cy0ke2dyb3VwSW5kZXh9LSR7ZW5kcG9pbnRJbmRleH1gKS50ZXh0Q29udGVudCA9ICdFcnJvcic7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBzdGF0dXMtJHtncm91cEluZGV4fS0ke2VuZHBvaW50SW5kZXh9YCkuY2xhc3NOYW1lID0gJ3Jlc3BvbnNlLXN0YXR1cyBlcnJvcic7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEV4ZWN1dGUgdGhlIHJlcXVlc3QKICAgICAgICAgICAgZmV0Y2godXJsLCB7CiAgICAgICAgICAgICAgICBtZXRob2Q6IGVuZHBvaW50Lm1ldGhvZCwKICAgICAgICAgICAgICAgIGhlYWRlcnM6IGhlYWRlcnMsCiAgICAgICAgICAgICAgICBib2R5OiBib2R5ID8gSlNPTi5zdHJpbmdpZnkoYm9keSkgOiBudWxsCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgICAgICAgIC8vIERpc3BsYXkgc3RhdHVzCiAgICAgICAgICAgICAgICBjb25zdCBzdGF0dXNFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHN0YXR1cy0ke2dyb3VwSW5kZXh9LSR7ZW5kcG9pbnRJbmRleH1gKTsKICAgICAgICAgICAgICAgIHN0YXR1c0VsZW1lbnQudGV4dENvbnRlbnQgPSBgJHtyZXNwb25zZS5zdGF0dXN9ICR7cmVzcG9uc2Uuc3RhdHVzVGV4dH1gOwogICAgICAgICAgICAgICAgc3RhdHVzRWxlbWVudC5jbGFzc05hbWUgPSBgcmVzcG9uc2Utc3RhdHVzICR7cmVzcG9uc2Uub2sgPyAnc3VjY2VzcycgOiAnZXJyb3InfWA7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIERpc3BsYXkgaGVhZGVycwogICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2VIZWFkZXJzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHJlc3BvbnNlLWhlYWRlcnMtJHtncm91cEluZGV4fS0ke2VuZHBvaW50SW5kZXh9YCk7CiAgICAgICAgICAgICAgICBsZXQgaGVhZGVyc1RleHQgPSAnJzsKICAgICAgICAgICAgICAgIHJlc3BvbnNlLmhlYWRlcnMuZm9yRWFjaCgodmFsdWUsIG5hbWUpID0+IHsKICAgICAgICAgICAgICAgICAgICBoZWFkZXJzVGV4dCArPSBgJHtuYW1lfTogJHt2YWx1ZX1cbmA7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gQXBwbHkgaGVhZGVyIGhpZ2hsaWdodGluZyBpZiBjb25maWd1cmVkCiAgICAgICAgICAgICAgICBpZiAoYXBpRG9jLnJlc3BvbnNlSGVhZGVycyAmJiBhcGlEb2MucmVzcG9uc2VIZWFkZXJzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICByZXNwb25zZUhlYWRlcnMuaW5uZXJIVE1MID0gaGlnaGxpZ2h0UmVzcG9uc2VIZWFkZXJzKGhlYWRlcnNUZXh0LCBhcGlEb2MucmVzcG9uc2VIZWFkZXJzKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2VIZWFkZXJzLnRleHRDb250ZW50ID0gaGVhZGVyc1RleHQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIENoZWNrIGNvbnRlbnQgdHlwZSBmb3IgSlNPTgogICAgICAgICAgICAgICAgY29uc3QgY29udGVudFR5cGUgPSByZXNwb25zZS5oZWFkZXJzLmdldCgnY29udGVudC10eXBlJyk7CiAgICAgICAgICAgICAgICBpZiAoY29udGVudFR5cGUgJiYgY29udGVudFR5cGUuaW5jbHVkZXMoJ2FwcGxpY2F0aW9uL2pzb24nKSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCkudGhlbihkYXRhID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KGRhdGEsIG51bGwsIDIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNKc29uOiB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS50ZXh0KCkudGhlbih0ZXh0ID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHRleHQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc0pzb246IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC50aGVuKCh7IGRhdGEsIGlzSnNvbiB9KSA9PiB7CiAgICAgICAgICAgICAgICAvLyBEaXNwbGF5IHJlc3BvbnNlIGJvZHkKICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlQm9keSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGByZXNwb25zZS1ib2R5LSR7Z3JvdXBJbmRleH0tJHtlbmRwb2ludEluZGV4fWApOwogICAgICAgICAgICAgICAgcmVzcG9uc2VCb2R5LnRleHRDb250ZW50ID0gZGF0YTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gQWRkIHN5bnRheCBoaWdobGlnaHRpbmcgZm9yIEpTT04gKHNpbXBsaWZpZWQgdmVyc2lvbikKICAgICAgICAgICAgICAgIGlmIChpc0pzb24pIHsKICAgICAgICAgICAgICAgICAgICByZXNwb25zZUJvZHkuY2xhc3NMaXN0LmFkZCgnanNvbicpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4gewogICAgICAgICAgICAgICAgLy8gRGlzcGxheSBlcnJvcgogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHJlc3BvbnNlLWJvZHktJHtncm91cEluZGV4fS0ke2VuZHBvaW50SW5kZXh9YCkudGV4dENvbnRlbnQgPSBgRXJyb3I6ICR7ZXJyb3IubWVzc2FnZX1gOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHN0YXR1cy0ke2dyb3VwSW5kZXh9LSR7ZW5kcG9pbnRJbmRleH1gKS50ZXh0Q29udGVudCA9ICdFcnJvcic7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgc3RhdHVzLSR7Z3JvdXBJbmRleH0tJHtlbmRwb2ludEluZGV4fWApLmNsYXNzTmFtZSA9ICdyZXNwb25zZS1zdGF0dXMgZXJyb3InOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gRmV0Y2ggdGhlIEFQSSBkb2N1bWVudGF0aW9uIEpTT04gZnJvbSB0aGUgc2VydmVyCiAgICAgICAgZmV0Y2goJy9taWNyb2FwaWRvY3MvZG9jLmpzb24nKQogICAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gbG9hZCBBUEkgZG9jdW1lbnRhdGlvbjogJHtyZXNwb25zZS5zdGF0dXN9ICR7cmVzcG9uc2Uuc3RhdHVzVGV4dH1gKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC50aGVuKGRhdGEgPT4gewogICAgICAgICAgICAgICAgLy8gU3RvcmUgdGhlIEFQSSBkYXRhIGdsb2JhbGx5IGZvciBhY2Nlc3MgaW4gZXZlbnQgaGFuZGxlcnMKICAgICAgICAgICAgICAgIHdpbmRvdy5hcGlEb2NEYXRhID0gZGF0YTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gSW5pdGlhbGl6ZSB0aGUgZG9jdW1lbnRhdGlvbiB3aXRoIHRoZSBmZXRjaGVkIGRhdGEKICAgICAgICAgICAgICAgIGluaXRpYWxpemVBcGlEb2NzKGRhdGEpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4gewogICAgICAgICAgICAgICAgLy8gRGlzcGxheSBlcnJvciBtZXNzYWdlCiAgICAgICAgICAgICAgICBjb25zdCBhcGlEb2NzQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FwaS1kb2NzJyk7CiAgICAgICAgICAgICAgICBhcGlEb2NzQ29udGFpbmVyLmlubmVySFRNTCA9IGAKICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJlcnJvci1tZXNzYWdlIj4KICAgICAgICAgICAgICAgICAgICAgICAgPHN0cm9uZz5FcnJvciBsb2FkaW5nIEFQSSBkb2N1bWVudGF0aW9uOjwvc3Ryb25nPiAke2Vycm9yLm1lc3NhZ2V9CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICBgOwogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgbG9hZGluZyBBUEkgZG9jdW1lbnRhdGlvbjonLCBlcnJvcik7CiAgICAgICAgICAgIH0pOwogICAgPC9zY3JpcHQ+CjwvYm9keT4KPC9odG1sPg==`

		decodedIndexHtml, err := base64.StdEncoding.DecodeString(indexB64)
		if err != nil {
			ctx.String(500, "Failed to decode index HTML: %v", err)
			return
		}
		indexHtml := string(decodedIndexHtml)

		ctx.Data(200, "text/html; charset=utf-8", []byte(indexHtml))
		return

	*/
}
